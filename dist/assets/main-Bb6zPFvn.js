import{r,j as t,c as $}from"./index-CQFZbpCx.js";const A="http://localhost:3001",D="";function F(){const[n,m]=r.useState(""),[a,f]=r.useState([]),[l,y]=r.useState("local"),[B,g]=r.useState([]),[j,S]=r.useState(!1),[w,b]=r.useState(""),[E,M]=r.useState(""),[k,C]=r.useState(""),[p,d]=r.useState(""),[x,u]=r.useState(null);r.useEffect(()=>{typeof chrome<"u"&&chrome.tabs?chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(e[0]&&e[0].url){const s=e[0].url;m(s),I()}}):m("http://localhost")},[]),r.useEffect(()=>{l!=="remote"||!n||v()},[l,n]);const I=()=>{typeof chrome<"u"&&chrome.storage&&chrome.storage.local.get(["memos"],e=>{e.memos&&f(e.memos)})},R=()=>{const e=p.trim();if(!e)return;let s;const c=new Date().toLocaleString();if(x)s=a.map(o=>o.id===x?{...o,text:e,updatedAt:c}:o),u(null);else{const o={id:Date.now(),url:n,text:e,createdAt:c,updatedAt:c};s=[...a,o]}f(s),d(""),typeof chrome<"u"&&chrome.storage&&chrome.storage.local.set({memos:s},()=>{console.log("Saved")})},z=async()=>{const e=p.trim(),s=a.filter(o=>o.url===n).at(-1),c=e||s?.text||"";if(c){M(""),C("");try{const o={url:n,text:c},i=await fetch(`${A}/memos`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok){const U=await i.text();throw new Error(U||`API error: ${i.status}`)}M("ÂÖ±Êúâ„Åó„Åæ„Åó„Åü")}catch(o){console.warn("DB‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",o);const i=o instanceof Error&&o.message?o.message:"DB‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü";C(i)}}},v=async()=>{if(n){S(!0),b("");try{const e=await fetch(`${A}/memos?url=${encodeURIComponent(n)}`);if(!e.ok)throw new Error(`API error: ${e.status}`);const s=await e.json();g(Array.isArray(s)?s:[])}catch{b("ÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),g([])}finally{S(!1)}}},_=e=>{d(e.text),u(e.id)},L=()=>{d(""),u(null)},P=a.filter(e=>e.url===n),h=l==="remote"?B:P,T=e=>e.updated_at||e.updatedAt||e.created_at||e.createdAt||"";return t.jsxs("div",{style:{width:"300px",padding:"16px",fontFamily:"sans-serif"},children:[t.jsx("h2",{children:"üìù URL Memo"}),t.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"12px"},children:[t.jsx("button",{onClick:()=>y("local"),style:{flex:1,background:l==="local"?"#ddd":""},children:"„É≠„Éº„Ç´„É´"}),t.jsx("button",{onClick:()=>y("remote"),style:{flex:1,background:l==="remote"?"#ddd":""},children:"„É™„É¢„Éº„Éà"})]}),t.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"10px",wordBreak:"break-all"},children:["Current: ",n]}),l==="local"&&t.jsxs(t.Fragment,{children:[t.jsx("textarea",{style:{width:"100%",height:"80px",marginBottom:"8px",boxSizing:"border-box"},value:p,onChange:e=>d(e.target.value),placeholder:"„É°„É¢„ÇíÂÖ•Âäõ..."}),t.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[t.jsx("button",{onClick:R,style:{flex:1},children:x?"Êõ¥Êñ∞„Åô„Çã":"‰øùÂ≠ò„Åô„Çã"}),t.jsx("button",{onClick:z,style:{flex:1},children:"ÂÖ±Êúâ"}),x&&t.jsx("button",{onClick:L,style:{background:"#ccc"},children:"„Ç≠„É£„É≥„Çª„É´"})]}),E&&t.jsx("p",{style:{color:"#2b7",fontSize:"12px"},children:E}),k&&t.jsx("p",{style:{color:"#c00",fontSize:"12px"},children:k})]}),l==="remote"&&t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("button",{onClick:v,style:{width:"100%"},disabled:j,children:j?"Ë™≠„ÅøËæº„Åø‰∏≠...":"„É™„É¢„Éº„ÉàÊõ¥Êñ∞"}),w&&t.jsx("p",{style:{color:"#c00",fontSize:"12px"},children:w})]}),t.jsx("hr",{}),t.jsxs("h3",{children:["„Åì„ÅÆ„Éö„Éº„Ç∏„ÅÆ„É°„É¢‰∏ÄË¶ß (",h.length,")"]}),t.jsx("ul",{style:{listStyle:"none",padding:0},children:h.map(e=>t.jsxs("li",{style:{border:"1px solid #eee",padding:"8px",marginBottom:"8px",borderRadius:"4px",backgroundColor:"#f9f9f9",color:"#333"},children:[t.jsx("div",{style:{whiteSpace:"pre-wrap",marginBottom:"4px"},children:e.text}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{style:{fontSize:"10px",color:"#888"},children:T(e)}),l==="remote"?t.jsx("span",{style:{fontSize:"10px",color:"#888"},children:e.user_id?`by ${e.user_id}`:""}):t.jsx("button",{onClick:()=>_(e),style:{fontSize:"12px",padding:"2px 8px"},children:"Á∑®ÈõÜ"})]})]},e.id))}),h.length===0&&t.jsx("p",{style:{textAlign:"center",color:"#888"},children:"„É°„É¢„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"})]})}$.createRoot(document.getElementById("root")).render(t.jsx(r.StrictMode,{children:t.jsx(F,{})}));
