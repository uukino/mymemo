import{j as e,r as l,c as D}from"./index-CQFZbpCx.js";function L({inputText:n,setInputText:a,editingId:i,saveMemo:d,shareMemo:o,handleCancel:h,shareMessage:u,shareError:x}){return e.jsxs("div",{children:[e.jsx("textarea",{style:{width:"100%",height:"80px",marginBottom:"8px",boxSizing:"border-box"},value:n,onChange:p=>a(p.target.value),placeholder:"ãƒ¡ãƒ¢ã‚’å…¥åŠ›..."}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[e.jsx("button",{onClick:d,style:{flex:1},children:i?"æ›´æ–°ã™ã‚‹":"ä¿å­˜ã™ã‚‹"}),e.jsx("button",{onClick:o,style:{flex:1},children:"å…±æœ‰"}),i&&e.jsx("button",{onClick:h,style:{background:"#ccc"},children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]}),u&&e.jsx("p",{style:{color:"#2b7",fontSize:"12px"},children:u}),x&&e.jsx("p",{style:{color:"#c00",fontSize:"12px"},children:x})]})}function O({viewMode:n,currentList:a,formatTimestamp:i,handleEdit:d}){return e.jsxs("div",{children:[e.jsx("hr",{}),e.jsxs("h3",{children:["ã“ã®ãƒšãƒ¼ã‚¸ã®ãƒ¡ãƒ¢ä¸€è¦§ (",a.length,")"]}),e.jsx("ul",{children:a.map(o=>e.jsxs("li",{children:[e.jsx("div",{children:o.text}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"10px",color:"#888"},children:i(o)}),n==="remote"?e.jsx("span",{style:{fontSize:"10px",color:"#888"},children:o.user_id?`by ${o.user_id}`:""}):e.jsx("button",{onClick:()=>d(o),style:{fontSize:"12px",padding:"2px 8px"},children:"ç·¨é›†"})]})]},o.id))}),a.length===0&&e.jsx("p",{children:"ãƒ¡ãƒ¢ã¯ã‚ã‚Šã¾ã›ã‚“"})]})}const k="https://mymemo-y2n2.onrender.com",q="";function F(){const[n,a]=l.useState(""),[i,d]=l.useState([]),[o,h]=l.useState("local"),[u,x]=l.useState([]),[p,S]=l.useState(!1),[w,b]=l.useState(""),[g,f]=l.useState(""),[y,j]=l.useState(null),[C,M]=l.useState(""),[A,v]=l.useState("");l.useEffect(()=>{typeof chrome<"u"&&chrome.tabs?chrome.tabs.query({active:!0,currentWindow:!0},t=>{if(t[0]&&t[0].url){const s=t[0].url;a(s),B()}}):a("http://localhost")},[]),l.useEffect(()=>{o!=="remote"||!n||E()},[o,n]);const B=()=>{typeof chrome<"u"&&chrome.storage&&chrome.storage.local.get(["memos"],t=>{t.memos&&d(t.memos)})},I=()=>{const t=g.trim();if(!t)return;let s;const c=new Date().toLocaleString();if(y)s=i.map(r=>r.id===y?{...r,text:t,updatedAt:c}:r),j(null);else{const r={id:Date.now(),url:n,text:t,createdAt:c,updatedAt:c};s=[...i,r]}d(s),f(""),typeof chrome<"u"&&chrome.storage&&chrome.storage.local.set({memos:s},()=>{console.log("Saved")})},R=async()=>{const t=g.trim(),s=i.filter(r=>r.url===n).at(-1),c=t||s?.text||"";if(c){M(""),v("");try{const r={url:n,text:c},m=await fetch(`${k}/memos`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!m.ok){const $=await m.text();throw new Error($||`API error: ${m.status}`)}M("å…±æœ‰ã—ã¾ã—ãŸ")}catch(r){console.warn("DBä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ",r);const m=r instanceof Error&&r.message?r.message:"DBä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ";v(m)}}},E=async()=>{if(n){S(!0),b("");try{const t=await fetch(`${k}/memos?url=${encodeURIComponent(n)}`);if(!t.ok)throw new Error(`API error: ${t.status}`);const s=await t.json();x(Array.isArray(s)?s:[])}catch{b("å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"),x([])}finally{S(!1)}}},z=t=>{f(t.text),j(t.id)},_=()=>{f(""),j(null)},P=i.filter(t=>t.url===n),T=o==="remote"?u:P,U=t=>t.updated_at||t.updatedAt||t.created_at||t.createdAt||"";return e.jsxs("div",{style:{width:"300px",padding:"16px",fontFamily:"sans-serif"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"12px"},children:[e.jsx("h2",{children:"ğŸ“ URL Memo"}),e.jsx("button",{onClick:()=>{console.log("toggle all memo"),chrome.storage.local.get(["memos"],t=>{const s=t.memos||[];s.forEach(c=>{console.log(c),c.hidden=!c.hidden}),console.log(s),chrome.storage.local.set({memos:s}),console.log(s)})},children:"Ã—"})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"12px"},children:[e.jsx("button",{onClick:()=>h("local"),style:{flex:1,background:o==="local"?"#ddd":""},children:"ãƒ­ãƒ¼ã‚«ãƒ«"}),e.jsx("button",{onClick:()=>h("remote"),style:{flex:1,background:o==="remote"?"#ddd":""},children:"ãƒªãƒ¢ãƒ¼ãƒˆ"})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",marginBottom:"10px",wordBreak:"break-all"},children:["Current: ",n]}),o==="local"&&e.jsx(L,{inputText:g,setInputText:f,editingId:y,saveMemo:I,shareMemo:R,handleCancel:_,shareMessage:C,shareError:A}),o==="remote"&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("button",{onClick:E,style:{width:"100%"},disabled:p,children:p?"èª­ã¿è¾¼ã¿ä¸­...":"ãƒªãƒ¢ãƒ¼ãƒˆæ›´æ–°"}),w&&e.jsx("p",{style:{color:"#c00",fontSize:"12px"},children:w})]}),e.jsx(O,{viewMode:o,currentList:T,formatTimestamp:U,handleEdit:z})]})}D.createRoot(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(F,{})}));
